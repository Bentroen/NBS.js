"use strict";var cr=Object.defineProperty,ur=(e,t,r)=>t in e?cr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,$e=(e,t,r)=>ur(e,typeof t!="symbol"?t+"":t,r);class Se{constructor(t){$e(this,"buffer"),$e(this,"viewer"),$e(this,"nextByte",0),this.buffer=t,this.viewer=new DataView(t)}}class Ge extends Se{readByte(){const t=this.viewer.getInt8(this.nextByte);return this.nextByte+=1,t}readUnsingedByte(){const t=this.viewer.getUint8(this.nextByte);return this.nextByte+=1,t}readShort(){const t=this.viewer.getInt16(this.nextByte,!0);return this.nextByte+=2,t}readInt(){const t=this.viewer.getInt32(this.nextByte,!0);return this.nextByte+=4,t}readString(){const t=this.readInt();let r="";for(let n=0;n<t;n++){const s=this.readUnsingedByte();r+=String.fromCodePoint(s)}return r}}var He=e=>{throw TypeError(e)},qe=(e,t,r)=>t.has(e)||He("Cannot "+r),ye=(e,t,r)=>(qe(e,t,"read from private field"),r?r.call(e):t.get(e)),dr=(e,t,r)=>t.has(e)?He("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),hr=(e,t,r,n)=>(qe(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),M;class Qe extends Se{constructor(t,r=!1){super(t),dr(this,M),hr(this,M,r)}writeByte(t=0){ye(this,M)||this.viewer.setInt8(this.nextByte,Math.floor(t)),this.nextByte+=1}writeUnsignedByte(t=0){ye(this,M)||this.viewer.setUint8(this.nextByte,t),this.nextByte+=1}writeShort(t=0){ye(this,M)||this.viewer.setInt16(this.nextByte,t,!0),this.nextByte+=2}writeInt(t=0){ye(this,M)||this.viewer.setInt32(this.nextByte,t,!0),this.nextByte+=4}writeString(t=""){this.writeInt(t.length);for(const r of t)this.writeUnsignedByte(r.charCodeAt(0))}}M=new WeakMap;function b(e,{name:t,addInitializer:r}){return r(function(){const n=Object.getOwnPropertyDescriptor(this,t)??Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this),t);Object.defineProperty(this,t,{...n,enumerable:!0})}),e}class Xe extends Error{constructor(t){super(`Property "${t}" is read-only and cannot be modified!`),this.name="IllegalSetError"}}function S(e,{name:t,addInitializer:r}){return r(function(){const n=Object.getOwnPropertyDescriptor(this,t)??Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this),t);Object.defineProperty(this,t,{...n,set:()=>{throw new Xe(t.toString())}})}),e}var gr=Object.defineProperty,fr=(e,t,r)=>t in e?gr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,te=(e,t,r)=>fr(e,typeof t!="symbol"?t+"":t,r);const W={key:45,velocity:100,panning:0,pitch:0};class Be{constructor(t,r=W){te(this,"instrument",0),te(this,"key",W.key),te(this,"velocity",W.velocity),te(this,"panning",W.panning),te(this,"pitch",W.pitch);const n={...W,...r};this.instrument=t,this.key=n.key,this.velocity=n.velocity,this.panning=n.panning,this.pitch=n.pitch}}var yr=Object.create,ke=Object.defineProperty,pr=Object.getOwnPropertyDescriptor,Ye=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),D=e=>{throw TypeError(e)},mr=(e,t,r)=>t in e?ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ze=(e,t)=>ke(e,"name",{value:t,configurable:!0}),vr=e=>[,,,yr(e?.[Ye("metadata")]??null)],et=["class","method","getter","setter","accessor","field","value","get","set"],re=e=>e!==void 0&&typeof e!="function"?D("Function expected"):e,br=(e,t,r,n,s)=>({kind:et[e],name:t,metadata:n,addInitializer:a=>r._?D("Already initialized"):s.push(re(a||null))}),tt=(e,t)=>mr(t,Ye("metadata"),e[3]),wr=(e,t,r,n)=>{for(var s=0,a=e[t>>1],c=a&&a.length;s<c;s++)t&1?a[s].call(r):n=a[s].call(r,n);return n},Oe=(e,t,r,n,s,a)=>{var c,o,p,h,g,i=t&7,f=!!(t&8),d=!!(t&16),y=i>3?e.length+1:i?f?1:2:0,w=et[i+5],$=i>3&&(e[y-1]=[]),j=e[y]||(e[y]=[]),u=i&&(!d&&!f&&(s=s.prototype),i<5&&(i>3||!d)&&pr(i<4?s:{get[r](){return E(this,a)},set[r](l){return rt(this,a,l)}},r));i?d&&i<4&&Ze(a,(i>2?"set ":i>1?"get ":"")+r):Ze(s,r);for(var m=n.length-1;m>=0;m--)h=br(i,r,p={},e[3],j),i&&(h.static=f,h.private=d,g=h.access={has:d?l=>$r(s,l):l=>r in l},i^3&&(g.get=d?l=>(i^1?E:Br)(l,s,i^4?a:u.get):l=>l[r]),i>2&&(g.set=d?(l,v)=>rt(l,s,v,i^4?a:u.set):(l,v)=>l[r]=v)),o=(0,n[m])(i?i<4?d?a:u[w]:i>4?void 0:{get:u.get,set:u.set}:s,h),p._=1,i^4||o===void 0?re(o)&&(i>4?$.unshift(o):i?d?a=o:u[w]=o:s=o):typeof o!="object"||o===null?D("Object expected"):(re(c=o.get)&&(u.get=c),re(c=o.set)&&(u.set=c),re(c=o.init)&&$.unshift(c));return i||tt(e,s),u&&ke(s,r,u),d?i^4?a:u:s},je=(e,t,r)=>t.has(e)||D("Cannot "+r),$r=(e,t)=>Object(t)!==t?D('Cannot use the "in" operator on this value'):e.has(t),E=(e,t,r)=>(je(e,t,"read from private field"),r?r.call(e):t.get(e)),Sr=(e,t,r)=>t.has(e)?D("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),rt=(e,t,r,n)=>(je(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Br=(e,t,r)=>(je(e,t,"access private method"),r),nt,it,st,V,K;class U{constructor(){wr(K,5,this),Sr(this,V,{})}get total(){return Object.keys(E(this,V)).length}get ticks(){return Object.keys(E(this,V)).map(t=>+t)}get get(){return Object.freeze({...E(this,V)})}set(t,r){return E(this,V)[t]=r,r}add(t,r){return this.set(t,r)}create(t,r,n=W){const s=new Be(r,n);return this.add(t,s)}delete(t){delete E(this,V)[t]}*[(st=[b,S],it=[b,S],nt=[b,S],Symbol.iterator)](){for(const[t,r]of Object.entries(E(this,V)))yield[+t,r]}}K=vr(null),V=new WeakMap,Oe(K,2,"total",st,U),Oe(K,2,"ticks",it,U),Oe(K,2,"get",nt,U),tt(K,U);var kr=Object.create,Ie=Object.defineProperty,Or=Object.getOwnPropertyDescriptor,at=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),_=e=>{throw TypeError(e)},ot=(e,t,r)=>t in e?Ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,lt=(e,t)=>Ie(e,"name",{value:t,configurable:!0}),jr=e=>[,,,kr(e?.[at("metadata")]??null)],ct=["class","method","getter","setter","accessor","field","value","get","set"],ne=e=>e!==void 0&&typeof e!="function"?_("Function expected"):e,Ir=(e,t,r,n,s)=>({kind:ct[e],name:t,metadata:n,addInitializer:a=>r._?_("Already initialized"):s.push(ne(a||null))}),ut=(e,t)=>ot(t,at("metadata"),e[3]),xr=(e,t,r,n)=>{for(var s=0,a=e[t>>1],c=a&&a.length;s<c;s++)t&1?a[s].call(r):n=a[s].call(r,n);return n},Pr=(e,t,r,n,s,a)=>{var c,o,p,h,g,i=t&7,f=!!(t&8),d=!!(t&16),y=i>3?e.length+1:i?f?1:2:0,w=ct[i+5],$=i>3&&(e[y-1]=[]),j=e[y]||(e[y]=[]),u=i&&(!d&&!f&&(s=s.prototype),i<5&&(i>3||!d)&&Or(i<4?s:{get[r](){return Pe(this,a)},set[r](l){return dt(this,a,l)}},r));i?d&&i<4&&lt(a,(i>2?"set ":i>1?"get ":"")+r):lt(s,r);for(var m=n.length-1;m>=0;m--)h=Ir(i,r,p={},e[3],j),i&&(h.static=f,h.private=d,g=h.access={has:d?l=>Cr(s,l):l=>r in l},i^3&&(g.get=d?l=>(i^1?Pe:Ar)(l,s,i^4?a:u.get):l=>l[r]),i>2&&(g.set=d?(l,v)=>dt(l,s,v,i^4?a:u.set):(l,v)=>l[r]=v)),o=(0,n[m])(i?i<4?d?a:u[w]:i>4?void 0:{get:u.get,set:u.set}:s,h),p._=1,i^4||o===void 0?ne(o)&&(i>4?$.unshift(o):i?d?a=o:u[w]=o:s=o):typeof o!="object"||o===null?_("Object expected"):(ne(c=o.get)&&(u.get=c),ne(c=o.set)&&(u.set=c),ne(c=o.init)&&$.unshift(c));return i||ut(e,s),u&&Ie(s,r,u),d?i^4?a:u:s},ie=(e,t,r)=>ot(e,typeof t!="symbol"?t+"":t,r),xe=(e,t,r)=>t.has(e)||_("Cannot "+r),Cr=(e,t)=>Object(t)!==t?_('Cannot use the "in" operator on this value'):e.has(t),Pe=(e,t,r)=>(xe(e,t,"read from private field"),r?r.call(e):t.get(e)),Fr=(e,t,r)=>t.has(e)?_("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),dt=(e,t,r,n)=>(xe(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Ar=(e,t,r)=>(xe(e,t,"access private method"),r),ht,Ce,pe;const T={name:void 0,isLocked:!1,isSolo:!1,volume:100,stereo:0};ht=[S,b];class se{constructor(t=T){xr(pe,5,this),Fr(this,Ce,new U),ie(this,"name",T.name),ie(this,"isLocked",T.isLocked),ie(this,"isSolo",T.isSolo),ie(this,"volume",T.volume),ie(this,"stereo",T.stereo);const r={...T,...t};this.name=r.name,this.isLocked=r.isLocked,this.isSolo=r.isSolo,this.volume=r.volume,this.stereo=r.stereo}get notes(){return Pe(this,Ce)}}pe=jr(null),Ce=new WeakMap,Pr(pe,2,"notes",ht,se),ut(pe,se);var Lr=Object.create,Fe=Object.defineProperty,Wr=Object.getOwnPropertyDescriptor,gt=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),J=e=>{throw TypeError(e)},Er=(e,t,r)=>t in e?Fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ft=(e,t)=>Fe(e,"name",{value:t,configurable:!0}),Vr=e=>[,,,Lr(e?.[gt("metadata")]??null)],yt=["class","method","getter","setter","accessor","field","value","get","set"],ae=e=>e!==void 0&&typeof e!="function"?J("Function expected"):e,Tr=(e,t,r,n,s)=>({kind:yt[e],name:t,metadata:n,addInitializer:a=>r._?J("Already initialized"):s.push(ae(a||null))}),pt=(e,t)=>Er(t,gt("metadata"),e[3]),Nr=(e,t,r,n)=>{for(var s=0,a=e[t>>1],c=a&&a.length;s<c;s++)t&1?a[s].call(r):n=a[s].call(r,n);return n},mt=(e,t,r,n,s,a)=>{var c,o,p,h,g,i=t&7,f=!!(t&8),d=!!(t&16),y=i>3?e.length+1:i?f?1:2:0,w=yt[i+5],$=i>3&&(e[y-1]=[]),j=e[y]||(e[y]=[]),u=i&&(!d&&!f&&(s=s.prototype),i<5&&(i>3||!d)&&Wr(i<4?s:{get[r](){return P(this,a)},set[r](l){return vt(this,a,l)}},r));i?d&&i<4&&ft(a,(i>2?"set ":i>1?"get ":"")+r):ft(s,r);for(var m=n.length-1;m>=0;m--)h=Tr(i,r,p={},e[3],j),i&&(h.static=f,h.private=d,g=h.access={has:d?l=>Mr(s,l):l=>r in l},i^3&&(g.get=d?l=>(i^1?P:Dr)(l,s,i^4?a:u.get):l=>l[r]),i>2&&(g.set=d?(l,v)=>vt(l,s,v,i^4?a:u.set):(l,v)=>l[r]=v)),o=(0,n[m])(i?i<4?d?a:u[w]:i>4?void 0:{get:u.get,set:u.set}:s,h),p._=1,i^4||o===void 0?ae(o)&&(i>4?$.unshift(o):i?d?a=o:u[w]=o:s=o):typeof o!="object"||o===null?J("Object expected"):(ae(c=o.get)&&(u.get=c),ae(c=o.set)&&(u.set=c),ae(c=o.init)&&$.unshift(c));return i||pt(e,s),u&&Fe(s,r,u),d?i^4?a:u:s},Ae=(e,t,r)=>t.has(e)||J("Cannot "+r),Mr=(e,t)=>Object(t)!==t?J('Cannot use the "in" operator on this value'):e.has(t),P=(e,t,r)=>(Ae(e,t,"read from private field"),r?r.call(e):t.get(e)),zr=(e,t,r)=>t.has(e)?J("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),vt=(e,t,r,n)=>(Ae(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Dr=(e,t,r)=>(Ae(e,t,"access private method"),r),bt,wt,C,oe;class le{constructor(){Nr(oe,5,this),zr(this,C,[])}get total(){return P(this,C).length}get get(){return Object.freeze([...P(this,C)])}create(){const t=new se;return P(this,C)[P(this,C).length]=t,t}add(t){P(this,C)[P(this,C).length]=t}delete(t){P(this,C).splice(t,1)}[(wt=[b,S],bt=[b,S],Symbol.iterator)](){return P(this,C).values()}}oe=Vr(null),C=new WeakMap,mt(oe,2,"total",wt,le),mt(oe,2,"get",bt,le),pt(oe,le);var Kr=Object.create,Le=Object.defineProperty,Ur=Object.getOwnPropertyDescriptor,$t=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),R=e=>{throw TypeError(e)},St=(e,t,r)=>t in e?Le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Bt=(e,t)=>Le(e,"name",{value:t,configurable:!0}),_r=e=>[,,,Kr(e?.[$t("metadata")]??null)],kt=["class","method","getter","setter","accessor","field","value","get","set"],ce=e=>e!==void 0&&typeof e!="function"?R("Function expected"):e,Jr=(e,t,r,n,s)=>({kind:kt[e],name:t,metadata:n,addInitializer:a=>r._?R("Already initialized"):s.push(ce(a||null))}),Ot=(e,t)=>St(t,$t("metadata"),e[3]),jt=(e,t,r,n)=>{for(var s=0,a=e[t>>1],c=a&&a.length;s<c;s++)t&1?a[s].call(r):n=a[s].call(r,n);return n},It=(e,t,r,n,s,a)=>{var c,o,p,h,g,i=t&7,f=!!(t&8),d=!!(t&16),y=i>3?e.length+1:i?f?1:2:0,w=kt[i+5],$=i>3&&(e[y-1]=[]),j=e[y]||(e[y]=[]),u=i&&(!d&&!f&&(s=s.prototype),i<5&&(i>3||!d)&&Ur(i<4?s:{get[r](){return ue(this,a)},set[r](l){return Ee(this,a,l)}},r));i?d&&i<4&&Bt(a,(i>2?"set ":i>1?"get ":"")+r):Bt(s,r);for(var m=n.length-1;m>=0;m--)h=Jr(i,r,p={},e[3],j),i&&(h.static=f,h.private=d,g=h.access={has:d?l=>Rr(s,l):l=>r in l},i^3&&(g.get=d?l=>(i^1?ue:Gr)(l,s,i^4?a:u.get):l=>l[r]),i>2&&(g.set=d?(l,v)=>Ee(l,s,v,i^4?a:u.set):(l,v)=>l[r]=v)),o=(0,n[m])(i?i<4?d?a:u[w]:i>4?void 0:{get:u.get,set:u.set}:s,h),p._=1,i^4||o===void 0?ce(o)&&(i>4?$.unshift(o):i?d?a=o:u[w]=o:s=o):typeof o!="object"||o===null?R("Object expected"):(ce(c=o.get)&&(u.get=c),ce(c=o.set)&&(u.set=c),ce(c=o.init)&&$.unshift(c));return i||Ot(e,s),u&&Le(s,r,u),d?i^4?a:u:s},me=(e,t,r)=>St(e,typeof t!="symbol"?t+"":t,r),We=(e,t,r)=>t.has(e)||R("Cannot "+r),Rr=(e,t)=>Object(t)!==t?R('Cannot use the "in" operator on this value'):e.has(t),ue=(e,t,r)=>(We(e,t,"read from private field"),r?r.call(e):t.get(e)),xt=(e,t,r)=>t.has(e)?R("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Ee=(e,t,r,n)=>(We(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Gr=(e,t,r)=>(We(e,t,"access private method"),r),Pt,Ct,ve,G,be;const Ft={0:{name:"Harp",soundFile:"harp.ogg"},1:{name:"Double Bass",soundFile:"dbass.ogg"},2:{name:"Bass Drum",soundFile:"bdrum.ogg"},3:{name:"Snare Drum",soundFile:"sdrum.ogg"},4:{name:"Click",soundFile:"click.ogg"},5:{name:"Guitar",soundFile:"guitar.ogg"},6:{name:"Flute",soundFile:"flute.ogg"},7:{name:"Bell",soundFile:"bell.ogg"},8:{name:"Chime",soundFile:"icechime.ogg"},9:{name:"Xylophone",soundFile:"xylobone.ogg"},10:{name:"Iron Xylophone",soundFile:"iron_xylophone.ogg"},11:{name:"Cow Bell",soundFile:"cow_bell.ogg"},12:{name:"Didgeridoo",soundFile:"didgeridoo.ogg"},13:{name:"Bit",soundFile:"bit.ogg"},14:{name:"Banjo",soundFile:"banjo.ogg"},15:{name:"Pling",soundFile:"pling.ogg"}},L={name:"",soundFile:"",key:45,pressKey:!1};Ct=[b,S],Pt=[b,S];const N=class lr{constructor(t=L){jt(G,5,this),xt(this,be,!1),me(this,"name"),me(this,"soundFile"),me(this,"key",L.key),me(this,"pressKey",L.pressKey);const r={...L,...t};this.name=r.name??L.name,this.soundFile=r.soundFile??L.soundFile,this.pressKey=r.pressKey??L.pressKey,this.key=r.key??L.key}static get builtIn(){return Object.freeze({...ue(lr,ve)})}get isBuiltIn(){return ue(this,be)}};G=_r(null),ve=new WeakMap,be=new WeakMap,It(G,10,"builtIn",Ct,N),It(G,2,"isBuiltIn",Pt,N),Ot(G,N),jt(G,3,N),xt(N,ve,Object.fromEntries(Object.entries(Ft).map(([e,t])=>{const r=new N(t);return Ee(r,be,!0),[e,r]}))),ue(N,ve)[0].pressKey=!0;let z=N;var Hr=Object.create,Ve=Object.defineProperty,qr=Object.getOwnPropertyDescriptor,At=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),H=e=>{throw TypeError(e)},Qr=(e,t,r)=>t in e?Ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Lt=(e,t)=>Ve(e,"name",{value:t,configurable:!0}),Xr=e=>[,,,Hr(e?.[At("metadata")]??null)],Wt=["class","method","getter","setter","accessor","field","value","get","set"],de=e=>e!==void 0&&typeof e!="function"?H("Function expected"):e,Yr=(e,t,r,n,s)=>({kind:Wt[e],name:t,metadata:n,addInitializer:a=>r._?H("Already initialized"):s.push(de(a||null))}),Et=(e,t)=>Qr(t,At("metadata"),e[3]),Zr=(e,t,r,n)=>{for(var s=0,a=e[t>>1],c=a&&a.length;s<c;s++)t&1?a[s].call(r):n=a[s].call(r,n);return n},Te=(e,t,r,n,s,a)=>{var c,o,p,h,g,i=t&7,f=!!(t&8),d=!!(t&16),y=i>3?e.length+1:i?f?1:2:0,w=Wt[i+5],$=i>3&&(e[y-1]=[]),j=e[y]||(e[y]=[]),u=i&&(!d&&!f&&(s=s.prototype),i<5&&(i>3||!d)&&qr(i<4?s:{get[r](){return I(this,a)},set[r](l){return Tt(this,a,l)}},r));i?d&&i<4&&Lt(a,(i>2?"set ":i>1?"get ":"")+r):Lt(s,r);for(var m=n.length-1;m>=0;m--)h=Yr(i,r,p={},e[3],j),i&&(h.static=f,h.private=d,g=h.access={has:d?l=>en(s,l):l=>r in l},i^3&&(g.get=d?l=>(i^1?I:tn)(l,s,i^4?a:u.get):l=>l[r]),i>2&&(g.set=d?(l,v)=>Tt(l,s,v,i^4?a:u.set):(l,v)=>l[r]=v)),o=(0,n[m])(i?i<4?d?a:u[w]:i>4?void 0:{get:u.get,set:u.set}:s,h),p._=1,i^4||o===void 0?de(o)&&(i>4?$.unshift(o):i?d?a=o:u[w]=o:s=o):typeof o!="object"||o===null?H("Object expected"):(de(c=o.get)&&(u.get=c),de(c=o.set)&&(u.set=c),de(c=o.init)&&$.unshift(c));return i||Et(e,s),u&&Ve(s,r,u),d?i^4?a:u:s},Ne=(e,t,r)=>t.has(e)||H("Cannot "+r),en=(e,t)=>Object(t)!==t?H('Cannot use the "in" operator on this value'):e.has(t),I=(e,t,r)=>(Ne(e,t,"read from private field"),r?r.call(e):t.get(e)),Vt=(e,t,r)=>t.has(e)?H("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Tt=(e,t,r,n)=>(Ne(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),tn=(e,t,r)=>(Ne(e,t,"access private method"),r),Nt,Mt,zt,F,Me,q;class Q{constructor(){Zr(q,5,this),Vt(this,F,{...z.builtIn}),Vt(this,Me,+Object.keys(z.builtIn).at(-1)+1)}get total(){return Object.keys(I(this,F)).length}get get(){return Object.freeze({...I(this,F)})}get firstCustomIndex(){return I(this,Me)}set(t,r){if(I(this,F)[t]?.isBuiltIn){console.warn("Built-in instruments cannot be modified!");return}if(!I(this,F)[t-1])throw new Error("Instrument cannot be set out of order! There must be an instrument before or on this ID.");return I(this,F)[t]=r,r}add(t){return this.set(this.total,t)}create(t){const r=new z(t);return this.add(r)}delete(t){if(I(this,F)[t]?.isBuiltIn){console.warn("Built-in instruments cannot be deleted!");return}delete I(this,F)[t]}*[(zt=[b,S],Mt=[b,S],Nt=[b,S],Symbol.iterator)](){for(const[t,r]of Object.entries(I(this,F)))yield[+t,r]}}q=Xr(null),F=new WeakMap,Me=new WeakMap,Te(q,2,"total",zt,Q),Te(q,2,"get",Mt,Q),Te(q,2,"firstCustomIndex",Nt,Q),Et(q,Q);var rn=Object.create,ze=Object.defineProperty,nn=Object.getOwnPropertyDescriptor,Dt=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),X=e=>{throw TypeError(e)},Kt=(e,t,r)=>t in e?ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ut=(e,t)=>ze(e,"name",{value:t,configurable:!0}),sn=e=>[,,,rn(e?.[Dt("metadata")]??null)],_t=["class","method","getter","setter","accessor","field","value","get","set"],he=e=>e!==void 0&&typeof e!="function"?X("Function expected"):e,an=(e,t,r,n,s)=>({kind:_t[e],name:t,metadata:n,addInitializer:a=>r._?X("Already initialized"):s.push(he(a||null))}),Jt=(e,t)=>Kt(t,Dt("metadata"),e[3]),on=(e,t,r,n)=>{for(var s=0,a=e[t>>1],c=a&&a.length;s<c;s++)t&1?a[s].call(r):n=a[s].call(r,n);return n},A=(e,t,r,n,s,a)=>{var c,o,p,h,g,i=t&7,f=!!(t&8),d=!!(t&16),y=i>3?e.length+1:i?f?1:2:0,w=_t[i+5],$=i>3&&(e[y-1]=[]),j=e[y]||(e[y]=[]),u=i&&(!d&&!f&&(s=s.prototype),i<5&&(i>3||!d)&&nn(i<4?s:{get[r](){return x(this,a)},set[r](l){return Z(this,a,l)}},r));i?d&&i<4&&Ut(a,(i>2?"set ":i>1?"get ":"")+r):Ut(s,r);for(var m=n.length-1;m>=0;m--)h=an(i,r,p={},e[3],j),i&&(h.static=f,h.private=d,g=h.access={has:d?l=>ln(s,l):l=>r in l},i^3&&(g.get=d?l=>(i^1?x:cn)(l,s,i^4?a:u.get):l=>l[r]),i>2&&(g.set=d?(l,v)=>Z(l,s,v,i^4?a:u.set):(l,v)=>l[r]=v)),o=(0,n[m])(i?i<4?d?a:u[w]:i>4?void 0:{get:u.get,set:u.set}:s,h),p._=1,i^4||o===void 0?he(o)&&(i>4?$.unshift(o):i?d?a=o:u[w]=o:s=o):typeof o!="object"||o===null?X("Object expected"):(he(c=o.get)&&(u.get=c),he(c=o.set)&&(u.set=c),he(c=o.init)&&$.unshift(c));return i||Jt(e,s),u&&ze(s,r,u),d?i^4?a:u:s},O=(e,t,r)=>Kt(e,typeof t!="symbol"?t+"":t,r),De=(e,t,r)=>t.has(e)||X("Cannot "+r),ln=(e,t)=>Object(t)!==t?X('Cannot use the "in" operator on this value'):e.has(t),x=(e,t,r)=>(De(e,t,"read from private field"),r?r.call(e):t.get(e)),Y=(e,t,r)=>t.has(e)?X("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Z=(e,t,r,n)=>(De(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),cn=(e,t,r)=>(De(e,t,"access private method"),r),Rt,Gt,Ht,qt,Qt,Xt,Yt,Zt,er,tr,Ke,Ue,ge,ee,fe,_e,k;const rr={enabled:!1,interval:10},nr={enabled:!1,startTick:0,totalLoops:0};tr=[b,S],er=[b,S],Zt=[b,S],Yt=[b,S],Xt=[b,S],Qt=[b],qt=[b],Ht=[b,S],Gt=[b,S],Rt=[b,S];class B{constructor(){on(k,5,this),Y(this,Ke,{...nr}),Y(this,Ue,{...rr}),Y(this,ge,10),Y(this,ee,100),Y(this,fe,new le),Y(this,_e,new Q),O(this,"nbsVersion",5),O(this,"name"),O(this,"author"),O(this,"originalAuthor"),O(this,"description"),O(this,"importName"),O(this,"minutesSpent",0),O(this,"leftClicks",0),O(this,"rightClicks",0),O(this,"blocksAdded",0),O(this,"blocksRemoved",0),O(this,"timeSignature",4)}get length(){let t=0;for(const r of x(this,fe).get){const n=+Object.keys(r.notes.get).at(-1);n>t&&(t=n)}return t}get loop(){return x(this,Ke)}get autoSave(){return x(this,Ue)}get duration(){return this.length*x(this,ee)}get lastMeasure(){return Math.ceil(this.length/this.timeSignature)*this.timeSignature}get tempo(){return x(this,ge)}set tempo(t){Z(this,ge,t),Z(this,ee,20/t*50)}get timePerTick(){return x(this,ee)}set timePerTick(t){Z(this,ee,t),Z(this,ge,50/t*20)}get hasSolo(){let t=!1;for(const r of x(this,fe).get)if(r.isSolo){t=!0;break}return t}get instruments(){return x(this,_e)}get layers(){return x(this,fe)}}k=sn(null),Ke=new WeakMap,Ue=new WeakMap,ge=new WeakMap,ee=new WeakMap,fe=new WeakMap,_e=new WeakMap,A(k,2,"length",tr,B),A(k,2,"loop",er,B),A(k,2,"autoSave",Zt,B),A(k,2,"duration",Yt,B),A(k,2,"lastMeasure",Xt,B),A(k,2,"tempo",Qt,B),A(k,2,"timePerTick",qt,B),A(k,2,"hasSolo",Ht,B),A(k,2,"instruments",Gt,B),A(k,2,"layers",Rt,B),Jt(k,B);function we(e,t=!0){let r=e;t&&(r=Object.assign({},e),Object.setPrototypeOf(r,B.prototype));for(let n=r.layers.total-1;n>0;n--)r.layers.get[n].notes.total===0&&r.layers.delete(n);return r}const ir={ignoreEmptyLayers:!1};function un(e,t=ir){let r=e;t.ignoreEmptyLayers&&(r=we(e));const n=sr(r,0,!0).nextByte;return sr(r,n).buffer}function sr(e,t,r=!1){const n=new Qe(new ArrayBuffer(t),r);e.nbsVersion>=1&&(n.writeShort(0),n.writeByte(e.nbsVersion),n.writeByte(e.instruments.firstCustomIndex)),(e.nbsVersion===0||e.nbsVersion>=3)&&n.writeShort(e.length),n.writeShort(e.layers.total),n.writeString(e.name??""),n.writeString(e.author??""),n.writeString(e.originalAuthor??""),n.writeString(e.description??""),n.writeShort(e.tempo*100),n.writeByte(+e.autoSave.enabled),n.writeByte(e.autoSave.interval),n.writeByte(e.timeSignature),n.writeInt(Math.floor(e.minutesSpent)),n.writeInt(e.leftClicks),n.writeInt(e.rightClicks),n.writeInt(e.blocksAdded),n.writeInt(e.blocksRemoved),n.writeString(e.importName??""),e.nbsVersion>=4&&(n.writeByte(+e.loop.enabled),n.writeByte(e.loop.totalLoops),n.writeByte(e.loop.startTick)),n.writeByte(0);let s=-1;for(let c=0;c<=e.length;c++){let o=!1;for(const g of e.layers.get)if(g.notes.get[c]){o=!0;break}if(!o)continue;const p=c-s;s=c,n.writeShort(p);let h=-1;for(let g=0;g<e.layers.total;g++){const i=e.layers.get[g].notes.get[c];if(i){const f=g-h;h=g,n.writeShort(f),n.writeByte(i.instrument),n.writeByte(i.key),e.nbsVersion>=4&&(n.writeByte(i.velocity),n.writeUnsignedByte((i.panning??0)+100),n.writeShort(i.pitch))}}n.writeShort(0)}n.writeShort(0);for(const c of e.layers.get){if(n.writeString(c.name??""),e.nbsVersion>=4){let o=0;c.isLocked&&(o=1),c.isSolo&&(o=2),n.writeByte(o)}n.writeByte(c.volume),e.nbsVersion>=2&&n.writeByte(c.stereo+100)}const a=Object.keys(e.instruments.get).length;n.writeByte(a-e.instruments.firstCustomIndex);for(let c=0;c<a;c++){const o=e.instruments.get[c];o.isBuiltIn||(n.writeString(o.name??""),n.writeString(o.soundFile),n.writeByte(o.key),n.writeByte(+(o.pressKey??0)))}return n}const Je={pressKey:!1,isLocked:!1,isSolo:!1,volume:0,stereo:0,velocity:100,panning:0,pitch:0,isBuiltIn:!0};function dn(e){const t=we(e);return JSON.parse(JSON.stringify(t,(r,n)=>{if(!(Je[r]!==void 0&&n===Je[r]))return n}))}const ar={ignoreEmptyLayers:!1};function hn(e,t=ar){const r=new B,n=new Ge(e);let s=n.readShort();if(s===0?(r.nbsVersion=n.readByte(),n.readByte(),r.nbsVersion>=3&&(s=n.readShort())):r.nbsVersion=0,r.nbsVersion>5)throw new Error("This library does not support Note Block Songs created with versions greater than 5.");const a=n.readShort();r.name=n.readString(),r.author=n.readString(),r.originalAuthor=n.readString(),r.description=n.readString(),r.tempo=n.readShort()/100,r.autoSave.enabled=!!n.readByte(),r.autoSave.interval=n.readByte(),r.timeSignature=n.readByte(),r.minutesSpent=n.readInt(),r.leftClicks=n.readInt(),r.rightClicks=n.readInt(),r.blocksAdded=n.readInt(),r.blocksRemoved=n.readInt(),r.importName=n.readString();for(const h of["name","author","originalAuthor","description","importName"])r[h]===""&&(r[h]=void 0);r.nbsVersion>=4&&(r.loop.enabled=!!n.readByte(),r.loop.totalLoops=n.readByte(),r.loop.startTick=n.readShort());const c=[];let o=-1;for(;;){const h=n.readShort();if(h===0)break;o+=h;let g=-1;for(;;){const i=n.readShort();if(i===0)break;g+=i;const f=n.readByte(),d=n.readByte();let y=100,w=0,$=0;r.nbsVersion>=4&&(y=n.readByte(),w=n.readUnsingedByte()-100,$=n.readShort()),c.push({instrument:f,key:d,velocity:y,panning:w,pitch:$,layer:g,tick:o})}}if(r.nbsVersion>0&&r.nbsVersion<3&&(s=o),e.byteLength>n.nextByte)for(let h=0;h<a;h++){const g=r.layers.create(),i=n.readString();if(g.name=i===""?void 0:i,r.nbsVersion>=4){const d=n.readByte();d===1&&(g.isLocked=!0),d===2&&(g.isSolo=!0)}g.volume=n.readByte();let f=0;r.nbsVersion>=2&&(f=n.readUnsingedByte()-100),g.stereo=f}const p=n.readByte();for(let h=0;h<p;h++){const g=n.readString();r.instruments.set(r.instruments.firstCustomIndex+h,new z({name:g===""?void 0:g,soundFile:n.readString(),key:n.readByte(),pressKey:!!n.readByte()}))}for(const h of c){let g=r.layers.get[h.layer];g||(g=r.layers.create()),g.notes.create(h.tick,h.instrument,{key:h.key,panning:h.panning,pitch:h.pitch,velocity:h.velocity})}return t.ignoreEmptyLayers?we(r,!1):r}function or(e,t,r){for(const n of Object.keys(r)){if(e.includes(n))continue;const s=typeof t[n],a=typeof r[n];if(s==="object"&&a==="object"){or(e,t[n],r[n]);continue}s!=="undefined"&&s!==a||(t[n]=r[n])}}function Re(e,t,r,n){n in r&&typeof r[n]=="object"&&"get"in r[n]&&e(r[n].get)&&t(r[n].get)}function gn(e){if(typeof e!="object")throw new Error("Provided argument is not a valid JSON object!");const t=new B,r=[],n=Object.getPrototypeOf(t);for(const s of Object.getOwnPropertyNames(n)){if(s==="loop"||s==="autoSave")continue;const a=Object.getOwnPropertyDescriptor(t,s);a&&typeof a.set=="function"&&r.push(s)}return or(r,t,e),"tempo"in e&&typeof e.tempo=="number"?t.tempo=e.tempo:"timePerTick"in e&&typeof e.timePerTick=="number"&&(t.timePerTick=e.timePerTick),Re(Array.isArray,s=>{for(const a of s){const c=new se(a);Re(o=>typeof o=="object",o=>{for(const[p,h]of Object.entries(o))typeof h=="object"&&(!("instrument"in h)||typeof h.instrument!="number"||c.notes.set(+p,new Be(h.instrument,h)))},a,"notes"),t.layers.add(c)}},e,"layers"),Re(s=>typeof s=="object",s=>{const a=Object.entries(s);if(a.length>Object.keys(z.builtIn).length)for(const[c,o]of a)!("isBuiltIn"in o)||o.isBuiltIn==="true"||t.instruments.set(+c,new z(o))},e,"instruments"),t}exports.BufferReader=Ge,exports.BufferWrapper=Se,exports.BufferWriter=Qe,exports.IllegalSetError=Xe,exports.Instrument=z,exports.Layer=se,exports.LayerNotes=U,exports.Note=Be,exports.Song=B,exports.SongInstruments=Q,exports.SongLayers=le,exports.builtInBuilder=Ft,exports.defaultAutoSave=rr,exports.defaultFromArrayBufferOptions=ar,exports.defaultInstrumentOptions=L,exports.defaultLayerOptions=T,exports.defaultLoop=nr,exports.defaultNoteOptions=W,exports.defaultToArrayBufferOptions=ir,exports.enumerable=b,exports.fromArrayBuffer=hn,exports.fromJSON=gn,exports.ignoredValues=Je,exports.omitEmptyLayers=we,exports.readOnly=S,exports.toArrayBuffer=un,exports.toJSON=dn;
