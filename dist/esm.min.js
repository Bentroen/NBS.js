var cr=Object.defineProperty,hr=(e,t,r)=>t in e?cr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,$e=(e,t,r)=>hr(e,typeof t!="symbol"?t+"":t,r);class Se{constructor(t){$e(this,"buffer"),$e(this,"viewer"),$e(this,"nextByte",0),this.buffer=t,this.viewer=new DataView(t)}}class Ge extends Se{readByte(){const t=this.viewer.getInt8(this.nextByte);return this.nextByte+=1,t}readUnsingedByte(){const t=this.viewer.getUint8(this.nextByte);return this.nextByte+=1,t}readShort(){const t=this.viewer.getInt16(this.nextByte,!0);return this.nextByte+=2,t}readInt(){const t=this.viewer.getInt32(this.nextByte,!0);return this.nextByte+=4,t}readString(){const t=this.readInt();let r="";for(let n=0;n<t;n++){const s=this.readUnsingedByte();r+=String.fromCodePoint(s)}return r}}var He=e=>{throw TypeError(e)},qe=(e,t,r)=>t.has(e)||He("Cannot "+r),fe=(e,t,r)=>(qe(e,t,"read from private field"),r?r.call(e):t.get(e)),ur=(e,t,r)=>t.has(e)?He("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),dr=(e,t,r,n)=>(qe(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),z;class Qe extends Se{constructor(t,r=!1){super(t),ur(this,z),dr(this,z,r)}writeByte(t=0){fe(this,z)||this.viewer.setInt8(this.nextByte,Math.floor(t)),this.nextByte+=1}writeUnsignedByte(t=0){fe(this,z)||this.viewer.setUint8(this.nextByte,t),this.nextByte+=1}writeShort(t=0){fe(this,z)||this.viewer.setInt16(this.nextByte,t,!0),this.nextByte+=2}writeInt(t=0){fe(this,z)||this.viewer.setInt32(this.nextByte,t,!0),this.nextByte+=4}writeString(t=""){this.writeInt(t.length);for(const r of t)this.writeUnsignedByte(r.charCodeAt(0))}}z=new WeakMap;function b(e,{name:t,addInitializer:r}){return r(function(){const n=Object.getOwnPropertyDescriptor(this,t)??Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this),t);Object.defineProperty(this,t,{...n,enumerable:!0})}),e}class Xe extends Error{constructor(t){super(`Property "${t}" is read-only and cannot be modified!`),this.name="IllegalSetError"}}function S(e,{name:t,addInitializer:r}){return r(function(){const n=Object.getOwnPropertyDescriptor(this,t)??Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this),t);Object.defineProperty(this,t,{...n,set:()=>{throw new Xe(t.toString())}})}),e}var gr=Object.defineProperty,yr=(e,t,r)=>t in e?gr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,te=(e,t,r)=>yr(e,typeof t!="symbol"?t+"":t,r);const L={key:45,velocity:100,panning:0,pitch:0};class ke{constructor(t,r=L){te(this,"instrument",0),te(this,"key",L.key),te(this,"velocity",L.velocity),te(this,"panning",L.panning),te(this,"pitch",L.pitch);const n={...L,...r};this.instrument=t,this.key=n.key,this.velocity=n.velocity,this.panning=n.panning,this.pitch=n.pitch}}var fr=Object.create,Be=Object.defineProperty,pr=Object.getOwnPropertyDescriptor,Ye=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),N=e=>{throw TypeError(e)},mr=(e,t,r)=>t in e?Be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ze=(e,t)=>Be(e,"name",{value:t,configurable:!0}),vr=e=>[,,,fr(e?.[Ye("metadata")]??null)],et=["class","method","getter","setter","accessor","field","value","get","set"],re=e=>e!==void 0&&typeof e!="function"?N("Function expected"):e,br=(e,t,r,n,s)=>({kind:et[e],name:t,metadata:n,addInitializer:a=>r._?N("Already initialized"):s.push(re(a||null))}),tt=(e,t)=>mr(t,Ye("metadata"),e[3]),wr=(e,t,r,n)=>{for(var s=0,a=e[t>>1],c=a&&a.length;s<c;s++)t&1?a[s].call(r):n=a[s].call(r,n);return n},Oe=(e,t,r,n,s,a)=>{var c,o,p,d,g,i=t&7,y=!!(t&8),u=!!(t&16),f=i>3?e.length+1:i?y?1:2:0,w=et[i+5],$=i>3&&(e[f-1]=[]),j=e[f]||(e[f]=[]),h=i&&(!u&&!y&&(s=s.prototype),i<5&&(i>3||!u)&&pr(i<4?s:{get[r](){return V(this,a)},set[r](l){return rt(this,a,l)}},r));i?u&&i<4&&Ze(a,(i>2?"set ":i>1?"get ":"")+r):Ze(s,r);for(var m=n.length-1;m>=0;m--)d=br(i,r,p={},e[3],j),i&&(d.static=y,d.private=u,g=d.access={has:u?l=>$r(s,l):l=>r in l},i^3&&(g.get=u?l=>(i^1?V:kr)(l,s,i^4?a:h.get):l=>l[r]),i>2&&(g.set=u?(l,v)=>rt(l,s,v,i^4?a:h.set):(l,v)=>l[r]=v)),o=(0,n[m])(i?i<4?u?a:h[w]:i>4?void 0:{get:h.get,set:h.set}:s,d),p._=1,i^4||o===void 0?re(o)&&(i>4?$.unshift(o):i?u?a=o:h[w]=o:s=o):typeof o!="object"||o===null?N("Object expected"):(re(c=o.get)&&(h.get=c),re(c=o.set)&&(h.set=c),re(c=o.init)&&$.unshift(c));return i||tt(e,s),h&&Be(s,r,h),u?i^4?a:h:s},je=(e,t,r)=>t.has(e)||N("Cannot "+r),$r=(e,t)=>Object(t)!==t?N('Cannot use the "in" operator on this value'):e.has(t),V=(e,t,r)=>(je(e,t,"read from private field"),r?r.call(e):t.get(e)),Sr=(e,t,r)=>t.has(e)?N("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),rt=(e,t,r,n)=>(je(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),kr=(e,t,r)=>(je(e,t,"access private method"),r),nt,it,st,E,K;class U{constructor(){wr(K,5,this),Sr(this,E,{})}get total(){return Object.keys(V(this,E)).length}get ticks(){return Object.keys(V(this,E)).map(t=>+t)}get get(){return Object.freeze({...V(this,E)})}set(t,r){return V(this,E)[t]=r,r}add(t,r){return this.set(t,r)}create(t,r,n=L){const s=new ke(r,n);return this.add(t,s)}delete(t){delete V(this,E)[t]}*[(st=[b,S],it=[b,S],nt=[b,S],Symbol.iterator)](){for(const[t,r]of Object.entries(V(this,E)))yield[+t,r]}}K=vr(null),E=new WeakMap,Oe(K,2,"total",st,U),Oe(K,2,"ticks",it,U),Oe(K,2,"get",nt,U),tt(K,U);var Br=Object.create,Ie=Object.defineProperty,Or=Object.getOwnPropertyDescriptor,at=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),_=e=>{throw TypeError(e)},ot=(e,t,r)=>t in e?Ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,lt=(e,t)=>Ie(e,"name",{value:t,configurable:!0}),jr=e=>[,,,Br(e?.[at("metadata")]??null)],ct=["class","method","getter","setter","accessor","field","value","get","set"],ne=e=>e!==void 0&&typeof e!="function"?_("Function expected"):e,Ir=(e,t,r,n,s)=>({kind:ct[e],name:t,metadata:n,addInitializer:a=>r._?_("Already initialized"):s.push(ne(a||null))}),ht=(e,t)=>ot(t,at("metadata"),e[3]),xr=(e,t,r,n)=>{for(var s=0,a=e[t>>1],c=a&&a.length;s<c;s++)t&1?a[s].call(r):n=a[s].call(r,n);return n},Pr=(e,t,r,n,s,a)=>{var c,o,p,d,g,i=t&7,y=!!(t&8),u=!!(t&16),f=i>3?e.length+1:i?y?1:2:0,w=ct[i+5],$=i>3&&(e[f-1]=[]),j=e[f]||(e[f]=[]),h=i&&(!u&&!y&&(s=s.prototype),i<5&&(i>3||!u)&&Or(i<4?s:{get[r](){return Pe(this,a)},set[r](l){return ut(this,a,l)}},r));i?u&&i<4&&lt(a,(i>2?"set ":i>1?"get ":"")+r):lt(s,r);for(var m=n.length-1;m>=0;m--)d=Ir(i,r,p={},e[3],j),i&&(d.static=y,d.private=u,g=d.access={has:u?l=>Cr(s,l):l=>r in l},i^3&&(g.get=u?l=>(i^1?Pe:Ar)(l,s,i^4?a:h.get):l=>l[r]),i>2&&(g.set=u?(l,v)=>ut(l,s,v,i^4?a:h.set):(l,v)=>l[r]=v)),o=(0,n[m])(i?i<4?u?a:h[w]:i>4?void 0:{get:h.get,set:h.set}:s,d),p._=1,i^4||o===void 0?ne(o)&&(i>4?$.unshift(o):i?u?a=o:h[w]=o:s=o):typeof o!="object"||o===null?_("Object expected"):(ne(c=o.get)&&(h.get=c),ne(c=o.set)&&(h.set=c),ne(c=o.init)&&$.unshift(c));return i||ht(e,s),h&&Ie(s,r,h),u?i^4?a:h:s},ie=(e,t,r)=>ot(e,typeof t!="symbol"?t+"":t,r),xe=(e,t,r)=>t.has(e)||_("Cannot "+r),Cr=(e,t)=>Object(t)!==t?_('Cannot use the "in" operator on this value'):e.has(t),Pe=(e,t,r)=>(xe(e,t,"read from private field"),r?r.call(e):t.get(e)),Fr=(e,t,r)=>t.has(e)?_("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),ut=(e,t,r,n)=>(xe(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Ar=(e,t,r)=>(xe(e,t,"access private method"),r),dt,Ce,pe;const T={name:void 0,isLocked:!1,isSolo:!1,volume:100,stereo:0};dt=[S,b];class se{constructor(t=T){xr(pe,5,this),Fr(this,Ce,new U),ie(this,"name",T.name),ie(this,"isLocked",T.isLocked),ie(this,"isSolo",T.isSolo),ie(this,"volume",T.volume),ie(this,"stereo",T.stereo);const r={...T,...t};this.name=r.name,this.isLocked=r.isLocked,this.isSolo=r.isSolo,this.volume=r.volume,this.stereo=r.stereo}get notes(){return Pe(this,Ce)}}pe=jr(null),Ce=new WeakMap,Pr(pe,2,"notes",dt,se),ht(pe,se);var Wr=Object.create,Fe=Object.defineProperty,Lr=Object.getOwnPropertyDescriptor,gt=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),J=e=>{throw TypeError(e)},Vr=(e,t,r)=>t in e?Fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,yt=(e,t)=>Fe(e,"name",{value:t,configurable:!0}),Er=e=>[,,,Wr(e?.[gt("metadata")]??null)],ft=["class","method","getter","setter","accessor","field","value","get","set"],ae=e=>e!==void 0&&typeof e!="function"?J("Function expected"):e,Tr=(e,t,r,n,s)=>({kind:ft[e],name:t,metadata:n,addInitializer:a=>r._?J("Already initialized"):s.push(ae(a||null))}),pt=(e,t)=>Vr(t,gt("metadata"),e[3]),Mr=(e,t,r,n)=>{for(var s=0,a=e[t>>1],c=a&&a.length;s<c;s++)t&1?a[s].call(r):n=a[s].call(r,n);return n},mt=(e,t,r,n,s,a)=>{var c,o,p,d,g,i=t&7,y=!!(t&8),u=!!(t&16),f=i>3?e.length+1:i?y?1:2:0,w=ft[i+5],$=i>3&&(e[f-1]=[]),j=e[f]||(e[f]=[]),h=i&&(!u&&!y&&(s=s.prototype),i<5&&(i>3||!u)&&Lr(i<4?s:{get[r](){return P(this,a)},set[r](l){return vt(this,a,l)}},r));i?u&&i<4&&yt(a,(i>2?"set ":i>1?"get ":"")+r):yt(s,r);for(var m=n.length-1;m>=0;m--)d=Tr(i,r,p={},e[3],j),i&&(d.static=y,d.private=u,g=d.access={has:u?l=>zr(s,l):l=>r in l},i^3&&(g.get=u?l=>(i^1?P:Nr)(l,s,i^4?a:h.get):l=>l[r]),i>2&&(g.set=u?(l,v)=>vt(l,s,v,i^4?a:h.set):(l,v)=>l[r]=v)),o=(0,n[m])(i?i<4?u?a:h[w]:i>4?void 0:{get:h.get,set:h.set}:s,d),p._=1,i^4||o===void 0?ae(o)&&(i>4?$.unshift(o):i?u?a=o:h[w]=o:s=o):typeof o!="object"||o===null?J("Object expected"):(ae(c=o.get)&&(h.get=c),ae(c=o.set)&&(h.set=c),ae(c=o.init)&&$.unshift(c));return i||pt(e,s),h&&Fe(s,r,h),u?i^4?a:h:s},Ae=(e,t,r)=>t.has(e)||J("Cannot "+r),zr=(e,t)=>Object(t)!==t?J('Cannot use the "in" operator on this value'):e.has(t),P=(e,t,r)=>(Ae(e,t,"read from private field"),r?r.call(e):t.get(e)),Dr=(e,t,r)=>t.has(e)?J("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),vt=(e,t,r,n)=>(Ae(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Nr=(e,t,r)=>(Ae(e,t,"access private method"),r),bt,wt,C,oe;class le{constructor(){Mr(oe,5,this),Dr(this,C,[])}get total(){return P(this,C).length}get get(){return Object.freeze([...P(this,C)])}create(){const t=new se;return P(this,C)[P(this,C).length]=t,t}add(t){P(this,C)[P(this,C).length]=t}delete(t){P(this,C).splice(t,1)}[(wt=[b,S],bt=[b,S],Symbol.iterator)](){return P(this,C).values()}}oe=Er(null),C=new WeakMap,mt(oe,2,"total",wt,le),mt(oe,2,"get",bt,le),pt(oe,le);var Kr=Object.create,We=Object.defineProperty,Ur=Object.getOwnPropertyDescriptor,$t=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),R=e=>{throw TypeError(e)},St=(e,t,r)=>t in e?We(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,kt=(e,t)=>We(e,"name",{value:t,configurable:!0}),_r=e=>[,,,Kr(e?.[$t("metadata")]??null)],Bt=["class","method","getter","setter","accessor","field","value","get","set"],ce=e=>e!==void 0&&typeof e!="function"?R("Function expected"):e,Jr=(e,t,r,n,s)=>({kind:Bt[e],name:t,metadata:n,addInitializer:a=>r._?R("Already initialized"):s.push(ce(a||null))}),Ot=(e,t)=>St(t,$t("metadata"),e[3]),jt=(e,t,r,n)=>{for(var s=0,a=e[t>>1],c=a&&a.length;s<c;s++)t&1?a[s].call(r):n=a[s].call(r,n);return n},It=(e,t,r,n,s,a)=>{var c,o,p,d,g,i=t&7,y=!!(t&8),u=!!(t&16),f=i>3?e.length+1:i?y?1:2:0,w=Bt[i+5],$=i>3&&(e[f-1]=[]),j=e[f]||(e[f]=[]),h=i&&(!u&&!y&&(s=s.prototype),i<5&&(i>3||!u)&&Ur(i<4?s:{get[r](){return he(this,a)},set[r](l){return Ve(this,a,l)}},r));i?u&&i<4&&kt(a,(i>2?"set ":i>1?"get ":"")+r):kt(s,r);for(var m=n.length-1;m>=0;m--)d=Jr(i,r,p={},e[3],j),i&&(d.static=y,d.private=u,g=d.access={has:u?l=>Rr(s,l):l=>r in l},i^3&&(g.get=u?l=>(i^1?he:Gr)(l,s,i^4?a:h.get):l=>l[r]),i>2&&(g.set=u?(l,v)=>Ve(l,s,v,i^4?a:h.set):(l,v)=>l[r]=v)),o=(0,n[m])(i?i<4?u?a:h[w]:i>4?void 0:{get:h.get,set:h.set}:s,d),p._=1,i^4||o===void 0?ce(o)&&(i>4?$.unshift(o):i?u?a=o:h[w]=o:s=o):typeof o!="object"||o===null?R("Object expected"):(ce(c=o.get)&&(h.get=c),ce(c=o.set)&&(h.set=c),ce(c=o.init)&&$.unshift(c));return i||Ot(e,s),h&&We(s,r,h),u?i^4?a:h:s},me=(e,t,r)=>St(e,typeof t!="symbol"?t+"":t,r),Le=(e,t,r)=>t.has(e)||R("Cannot "+r),Rr=(e,t)=>Object(t)!==t?R('Cannot use the "in" operator on this value'):e.has(t),he=(e,t,r)=>(Le(e,t,"read from private field"),r?r.call(e):t.get(e)),xt=(e,t,r)=>t.has(e)?R("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Ve=(e,t,r,n)=>(Le(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Gr=(e,t,r)=>(Le(e,t,"access private method"),r),Pt,Ct,ve,G,be;const Ft={0:{name:"Harp",soundFile:"harp.ogg"},1:{name:"Double Bass",soundFile:"dbass.ogg"},2:{name:"Bass Drum",soundFile:"bdrum.ogg"},3:{name:"Snare Drum",soundFile:"sdrum.ogg"},4:{name:"Click",soundFile:"click.ogg"},5:{name:"Guitar",soundFile:"guitar.ogg"},6:{name:"Flute",soundFile:"flute.ogg"},7:{name:"Bell",soundFile:"bell.ogg"},8:{name:"Chime",soundFile:"icechime.ogg"},9:{name:"Xylophone",soundFile:"xylobone.ogg"},10:{name:"Iron Xylophone",soundFile:"iron_xylophone.ogg"},11:{name:"Cow Bell",soundFile:"cow_bell.ogg"},12:{name:"Didgeridoo",soundFile:"didgeridoo.ogg"},13:{name:"Bit",soundFile:"bit.ogg"},14:{name:"Banjo",soundFile:"banjo.ogg"},15:{name:"Pling",soundFile:"pling.ogg"}},W={name:"",soundFile:"",key:45,pressKey:!1};Ct=[b,S],Pt=[b,S];const M=class lr{constructor(t=W){jt(G,5,this),xt(this,be,!1),me(this,"name"),me(this,"soundFile"),me(this,"key",W.key),me(this,"pressKey",W.pressKey);const r={...W,...t};this.name=r.name??W.name,this.soundFile=r.soundFile??W.soundFile,this.pressKey=r.pressKey??W.pressKey,this.key=r.key??W.key}static get builtIn(){return Object.freeze({...he(lr,ve)})}get isBuiltIn(){return he(this,be)}};G=_r(null),ve=new WeakMap,be=new WeakMap,It(G,10,"builtIn",Ct,M),It(G,2,"isBuiltIn",Pt,M),Ot(G,M),jt(G,3,M),xt(M,ve,Object.fromEntries(Object.entries(Ft).map(([e,t])=>{const r=new M(t);return Ve(r,be,!0),[e,r]}))),he(M,ve)[0].pressKey=!0;let D=M;var Hr=Object.create,Ee=Object.defineProperty,qr=Object.getOwnPropertyDescriptor,At=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),H=e=>{throw TypeError(e)},Qr=(e,t,r)=>t in e?Ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Wt=(e,t)=>Ee(e,"name",{value:t,configurable:!0}),Xr=e=>[,,,Hr(e?.[At("metadata")]??null)],Lt=["class","method","getter","setter","accessor","field","value","get","set"],ue=e=>e!==void 0&&typeof e!="function"?H("Function expected"):e,Yr=(e,t,r,n,s)=>({kind:Lt[e],name:t,metadata:n,addInitializer:a=>r._?H("Already initialized"):s.push(ue(a||null))}),Vt=(e,t)=>Qr(t,At("metadata"),e[3]),Zr=(e,t,r,n)=>{for(var s=0,a=e[t>>1],c=a&&a.length;s<c;s++)t&1?a[s].call(r):n=a[s].call(r,n);return n},Te=(e,t,r,n,s,a)=>{var c,o,p,d,g,i=t&7,y=!!(t&8),u=!!(t&16),f=i>3?e.length+1:i?y?1:2:0,w=Lt[i+5],$=i>3&&(e[f-1]=[]),j=e[f]||(e[f]=[]),h=i&&(!u&&!y&&(s=s.prototype),i<5&&(i>3||!u)&&qr(i<4?s:{get[r](){return I(this,a)},set[r](l){return Tt(this,a,l)}},r));i?u&&i<4&&Wt(a,(i>2?"set ":i>1?"get ":"")+r):Wt(s,r);for(var m=n.length-1;m>=0;m--)d=Yr(i,r,p={},e[3],j),i&&(d.static=y,d.private=u,g=d.access={has:u?l=>en(s,l):l=>r in l},i^3&&(g.get=u?l=>(i^1?I:tn)(l,s,i^4?a:h.get):l=>l[r]),i>2&&(g.set=u?(l,v)=>Tt(l,s,v,i^4?a:h.set):(l,v)=>l[r]=v)),o=(0,n[m])(i?i<4?u?a:h[w]:i>4?void 0:{get:h.get,set:h.set}:s,d),p._=1,i^4||o===void 0?ue(o)&&(i>4?$.unshift(o):i?u?a=o:h[w]=o:s=o):typeof o!="object"||o===null?H("Object expected"):(ue(c=o.get)&&(h.get=c),ue(c=o.set)&&(h.set=c),ue(c=o.init)&&$.unshift(c));return i||Vt(e,s),h&&Ee(s,r,h),u?i^4?a:h:s},Me=(e,t,r)=>t.has(e)||H("Cannot "+r),en=(e,t)=>Object(t)!==t?H('Cannot use the "in" operator on this value'):e.has(t),I=(e,t,r)=>(Me(e,t,"read from private field"),r?r.call(e):t.get(e)),Et=(e,t,r)=>t.has(e)?H("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Tt=(e,t,r,n)=>(Me(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),tn=(e,t,r)=>(Me(e,t,"access private method"),r),Mt,zt,Dt,F,ze,q;class Q{constructor(){Zr(q,5,this),Et(this,F,{...D.builtIn}),Et(this,ze,+Object.keys(D.builtIn).at(-1)+1)}get total(){return Object.keys(I(this,F)).length}get get(){return Object.freeze({...I(this,F)})}get firstCustomIndex(){return I(this,ze)}set(t,r){if(I(this,F)[t]?.isBuiltIn){console.warn("Built-in instruments cannot be modified!");return}if(!I(this,F)[t-1])throw new Error("Instrument cannot be set out of order! There must be an instrument before or on this ID.");return I(this,F)[t]=r,r}add(t){return this.set(this.total,t)}create(t){const r=new D(t);return this.add(r)}delete(t){if(I(this,F)[t]?.isBuiltIn){console.warn("Built-in instruments cannot be deleted!");return}delete I(this,F)[t]}*[(Dt=[b,S],zt=[b,S],Mt=[b,S],Symbol.iterator)](){for(const[t,r]of Object.entries(I(this,F)))yield[+t,r]}}q=Xr(null),F=new WeakMap,ze=new WeakMap,Te(q,2,"total",Dt,Q),Te(q,2,"get",zt,Q),Te(q,2,"firstCustomIndex",Mt,Q),Vt(q,Q);var rn=Object.create,De=Object.defineProperty,nn=Object.getOwnPropertyDescriptor,Nt=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),X=e=>{throw TypeError(e)},Kt=(e,t,r)=>t in e?De(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ut=(e,t)=>De(e,"name",{value:t,configurable:!0}),sn=e=>[,,,rn(e?.[Nt("metadata")]??null)],_t=["class","method","getter","setter","accessor","field","value","get","set"],de=e=>e!==void 0&&typeof e!="function"?X("Function expected"):e,an=(e,t,r,n,s)=>({kind:_t[e],name:t,metadata:n,addInitializer:a=>r._?X("Already initialized"):s.push(de(a||null))}),Jt=(e,t)=>Kt(t,Nt("metadata"),e[3]),on=(e,t,r,n)=>{for(var s=0,a=e[t>>1],c=a&&a.length;s<c;s++)t&1?a[s].call(r):n=a[s].call(r,n);return n},A=(e,t,r,n,s,a)=>{var c,o,p,d,g,i=t&7,y=!!(t&8),u=!!(t&16),f=i>3?e.length+1:i?y?1:2:0,w=_t[i+5],$=i>3&&(e[f-1]=[]),j=e[f]||(e[f]=[]),h=i&&(!u&&!y&&(s=s.prototype),i<5&&(i>3||!u)&&nn(i<4?s:{get[r](){return x(this,a)},set[r](l){return Z(this,a,l)}},r));i?u&&i<4&&Ut(a,(i>2?"set ":i>1?"get ":"")+r):Ut(s,r);for(var m=n.length-1;m>=0;m--)d=an(i,r,p={},e[3],j),i&&(d.static=y,d.private=u,g=d.access={has:u?l=>ln(s,l):l=>r in l},i^3&&(g.get=u?l=>(i^1?x:cn)(l,s,i^4?a:h.get):l=>l[r]),i>2&&(g.set=u?(l,v)=>Z(l,s,v,i^4?a:h.set):(l,v)=>l[r]=v)),o=(0,n[m])(i?i<4?u?a:h[w]:i>4?void 0:{get:h.get,set:h.set}:s,d),p._=1,i^4||o===void 0?de(o)&&(i>4?$.unshift(o):i?u?a=o:h[w]=o:s=o):typeof o!="object"||o===null?X("Object expected"):(de(c=o.get)&&(h.get=c),de(c=o.set)&&(h.set=c),de(c=o.init)&&$.unshift(c));return i||Jt(e,s),h&&De(s,r,h),u?i^4?a:h:s},O=(e,t,r)=>Kt(e,typeof t!="symbol"?t+"":t,r),Ne=(e,t,r)=>t.has(e)||X("Cannot "+r),ln=(e,t)=>Object(t)!==t?X('Cannot use the "in" operator on this value'):e.has(t),x=(e,t,r)=>(Ne(e,t,"read from private field"),r?r.call(e):t.get(e)),Y=(e,t,r)=>t.has(e)?X("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Z=(e,t,r,n)=>(Ne(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),cn=(e,t,r)=>(Ne(e,t,"access private method"),r),Rt,Gt,Ht,qt,Qt,Xt,Yt,Zt,er,tr,Ke,Ue,ge,ee,ye,_e,B;const rr={enabled:!1,interval:10},nr={enabled:!1,startTick:0,totalLoops:0};tr=[b,S],er=[b,S],Zt=[b,S],Yt=[b,S],Xt=[b,S],Qt=[b],qt=[b],Ht=[b,S],Gt=[b,S],Rt=[b,S];class k{constructor(){on(B,5,this),Y(this,Ke,{...nr}),Y(this,Ue,{...rr}),Y(this,ge,10),Y(this,ee,100),Y(this,ye,new le),Y(this,_e,new Q),O(this,"nbsVersion",5),O(this,"name"),O(this,"author"),O(this,"originalAuthor"),O(this,"description"),O(this,"importName"),O(this,"minutesSpent",0),O(this,"leftClicks",0),O(this,"rightClicks",0),O(this,"blocksAdded",0),O(this,"blocksRemoved",0),O(this,"timeSignature",4)}get length(){let t=0;for(const r of x(this,ye).get){const n=+Object.keys(r.notes.get).at(-1);n>t&&(t=n)}return t}get loop(){return x(this,Ke)}get autoSave(){return x(this,Ue)}get duration(){return this.length*x(this,ee)}get lastMeasure(){return Math.ceil(this.length/this.timeSignature)*this.timeSignature}get tempo(){return x(this,ge)}set tempo(t){Z(this,ge,t),Z(this,ee,20/t*50)}get timePerTick(){return x(this,ee)}set timePerTick(t){Z(this,ee,t),Z(this,ge,50/t*20)}get hasSolo(){let t=!1;for(const r of x(this,ye).get)if(r.isSolo){t=!0;break}return t}get instruments(){return x(this,_e)}get layers(){return x(this,ye)}}B=sn(null),Ke=new WeakMap,Ue=new WeakMap,ge=new WeakMap,ee=new WeakMap,ye=new WeakMap,_e=new WeakMap,A(B,2,"length",tr,k),A(B,2,"loop",er,k),A(B,2,"autoSave",Zt,k),A(B,2,"duration",Yt,k),A(B,2,"lastMeasure",Xt,k),A(B,2,"tempo",Qt,k),A(B,2,"timePerTick",qt,k),A(B,2,"hasSolo",Ht,k),A(B,2,"instruments",Gt,k),A(B,2,"layers",Rt,k),Jt(B,k);function we(e,t=!0){let r=e;t&&(r=Object.assign({},e),Object.setPrototypeOf(r,k.prototype));for(let n=r.layers.total-1;n>0;n--)r.layers.get[n].notes.total===0&&r.layers.delete(n);return r}const ir={ignoreEmptyLayers:!1};function hn(e,t=ir){let r=e;t.ignoreEmptyLayers&&(r=we(e));const n=sr(r,0,!0).nextByte;return sr(r,n).buffer}function sr(e,t,r=!1){const n=new Qe(new ArrayBuffer(t),r);e.nbsVersion>=1&&(n.writeShort(0),n.writeByte(e.nbsVersion),n.writeByte(e.instruments.firstCustomIndex)),(e.nbsVersion===0||e.nbsVersion>=3)&&n.writeShort(e.length),n.writeShort(e.layers.total),n.writeString(e.name??""),n.writeString(e.author??""),n.writeString(e.originalAuthor??""),n.writeString(e.description??""),n.writeShort(e.tempo*100),n.writeByte(+e.autoSave.enabled),n.writeByte(e.autoSave.interval),n.writeByte(e.timeSignature),n.writeInt(Math.floor(e.minutesSpent)),n.writeInt(e.leftClicks),n.writeInt(e.rightClicks),n.writeInt(e.blocksAdded),n.writeInt(e.blocksRemoved),n.writeString(e.importName??""),e.nbsVersion>=4&&(n.writeByte(+e.loop.enabled),n.writeByte(e.loop.totalLoops),n.writeByte(e.loop.startTick)),n.writeByte(0);let s=-1;for(let c=0;c<=e.length;c++){let o=!1;for(const g of e.layers.get)if(g.notes.get[c]){o=!0;break}if(!o)continue;const p=c-s;s=c,n.writeShort(p);let d=-1;for(let g=0;g<e.layers.total;g++){const i=e.layers.get[g].notes.get[c];if(i){const y=g-d;d=g,n.writeShort(y),n.writeByte(i.instrument),n.writeByte(i.key),e.nbsVersion>=4&&(n.writeByte(i.velocity),n.writeUnsignedByte((i.panning??0)+100),n.writeShort(i.pitch))}}n.writeShort(0)}n.writeShort(0);for(const c of e.layers.get){if(n.writeString(c.name??""),e.nbsVersion>=4){let o=0;c.isLocked&&(o=1),c.isSolo&&(o=2),n.writeByte(o)}n.writeByte(c.volume),e.nbsVersion>=2&&n.writeByte(c.stereo+100)}const a=Object.keys(e.instruments.get).length;n.writeByte(a-e.instruments.firstCustomIndex);for(let c=0;c<a;c++){const o=e.instruments.get[c];o.isBuiltIn||(n.writeString(o.name??""),n.writeString(o.soundFile),n.writeByte(o.key),n.writeByte(+(o.pressKey??0)))}return n}const Je={pressKey:!1,isLocked:!1,isSolo:!1,volume:0,stereo:0,velocity:100,panning:0,pitch:0,isBuiltIn:!0};function un(e){const t=we(e);return JSON.parse(JSON.stringify(t,(r,n)=>{if(!(Je[r]!==void 0&&n===Je[r]))return n}))}const ar={ignoreEmptyLayers:!1};function dn(e,t=ar){const r=new k,n=new Ge(e);let s=n.readShort();if(s===0?(r.nbsVersion=n.readByte(),n.readByte(),r.nbsVersion>=3&&(s=n.readShort())):r.nbsVersion=0,r.nbsVersion>5)throw new Error("This library does not support Note Block Songs created with versions greater than 5.");const a=n.readShort();r.name=n.readString(),r.author=n.readString(),r.originalAuthor=n.readString(),r.description=n.readString(),r.tempo=n.readShort()/100,r.autoSave.enabled=!!n.readByte(),r.autoSave.interval=n.readByte(),r.timeSignature=n.readByte(),r.minutesSpent=n.readInt(),r.leftClicks=n.readInt(),r.rightClicks=n.readInt(),r.blocksAdded=n.readInt(),r.blocksRemoved=n.readInt(),r.importName=n.readString();for(const d of["name","author","originalAuthor","description","importName"])r[d]===""&&(r[d]=void 0);r.nbsVersion>=4&&(r.loop.enabled=!!n.readByte(),r.loop.totalLoops=n.readByte(),r.loop.startTick=n.readShort());const c=[];let o=-1;for(;;){const d=n.readShort();if(d===0)break;o+=d;let g=-1;for(;;){const i=n.readShort();if(i===0)break;g+=i;const y=n.readByte(),u=n.readByte();let f=100,w=0,$=0;r.nbsVersion>=4&&(f=n.readByte(),w=n.readUnsingedByte()-100,$=n.readShort()),c.push({instrument:y,key:u,velocity:f,panning:w,pitch:$,layer:g,tick:o})}}if(r.nbsVersion>0&&r.nbsVersion<3&&(s=o),e.byteLength>n.nextByte)for(let d=0;d<a;d++){const g=r.layers.create(),i=n.readString();if(g.name=i===""?void 0:i,r.nbsVersion>=4){const u=n.readByte();u===1&&(g.isLocked=!0),u===2&&(g.isSolo=!0)}g.volume=n.readByte();let y=0;r.nbsVersion>=2&&(y=n.readUnsingedByte()-100),g.stereo=y}const p=n.readByte();for(let d=0;d<p;d++){const g=n.readString();r.instruments.set(r.instruments.firstCustomIndex+d,new D({name:g===""?void 0:g,soundFile:n.readString(),key:n.readByte(),pressKey:!!n.readByte()}))}for(const d of c){let g=r.layers.get[d.layer];g||(g=r.layers.create()),g.notes.create(d.tick,d.instrument,{key:d.key,panning:d.panning,pitch:d.pitch,velocity:d.velocity})}return t.ignoreEmptyLayers?we(r,!1):r}function or(e,t,r){for(const n of Object.keys(r)){if(e.includes(n))continue;const s=typeof t[n],a=typeof r[n];if(s==="object"&&a==="object"){or(e,t[n],r[n]);continue}s!=="undefined"&&s!==a||(t[n]=r[n])}}function Re(e,t,r,n){n in r&&typeof r[n]=="object"&&"get"in r[n]&&e(r[n].get)&&t(r[n].get)}function gn(e){if(typeof e!="object")throw new Error("Provided argument is not a valid JSON object!");const t=new k,r=[],n=Object.getPrototypeOf(t);for(const s of Object.getOwnPropertyNames(n)){if(s==="loop"||s==="autoSave")continue;const a=Object.getOwnPropertyDescriptor(t,s);a&&typeof a.set=="function"&&r.push(s)}return or(r,t,e),"tempo"in e&&typeof e.tempo=="number"?t.tempo=e.tempo:"timePerTick"in e&&typeof e.timePerTick=="number"&&(t.timePerTick=e.timePerTick),Re(Array.isArray,s=>{for(const a of s){const c=new se(a);Re(o=>typeof o=="object",o=>{for(const[p,d]of Object.entries(o))typeof d=="object"&&(!("instrument"in d)||typeof d.instrument!="number"||c.notes.set(+p,new ke(d.instrument,d)))},a,"notes"),t.layers.add(c)}},e,"layers"),Re(s=>typeof s=="object",s=>{const a=Object.entries(s);if(a.length>Object.keys(D.builtIn).length)for(const[c,o]of a)!("isBuiltIn"in o)||o.isBuiltIn==="true"||t.instruments.set(+c,new D(o))},e,"instruments"),t}export{Ge as BufferReader,Se as BufferWrapper,Qe as BufferWriter,Xe as IllegalSetError,D as Instrument,se as Layer,U as LayerNotes,ke as Note,k as Song,Q as SongInstruments,le as SongLayers,Ft as builtInBuilder,rr as defaultAutoSave,ar as defaultFromArrayBufferOptions,W as defaultInstrumentOptions,T as defaultLayerOptions,nr as defaultLoop,L as defaultNoteOptions,ir as defaultToArrayBufferOptions,b as enumerable,dn as fromArrayBuffer,gn as fromJSON,Je as ignoredValues,we as omitEmptyLayers,S as readOnly,hn as toArrayBuffer,un as toJSON};
